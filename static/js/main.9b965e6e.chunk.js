(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{16:function(e,t,n){e.exports={container:"login_container__1PQ8s",submit:"login_submit__2kKaX",header:"login_header__5znqL"}},19:function(e,t,n){e.exports={container:"gateOpener_container__3nsRs",hidden:"gateOpener_hidden__3Q13x",logs:"gateOpener_logs__WzVmp"}},20:function(e,t,n){e.exports={container:"doorman_container__1jubE",response:"doorman_response__3Qr6R"}},26:function(e,t,n){e.exports={navbar:"header_navbar__2tHvZ"}},29:function(e,t,n){},30:function(e,t,n){e.exports=n(45)},35:function(e,t,n){},45:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(25),c=n.n(o),i=(n(35),n(10)),u=n(6),s=n(1),l=n.n(s),h=n(2),m=n(3),p=n(4),f=n(14),v=n(13),d=n(15),b=n(26),g=n.n(b),w=function(){return r.a.createElement("div",{className:g.a.navbar},r.a.createElement(i.b,{to:"/home/cams"},"Cams"),r.a.createElement(i.b,{to:"/home/gate"},"Gate"),r.a.createElement(i.b,{to:"/home/doorman"},"Doorman"),r.a.createElement(i.b,{to:"/home/nearby"},"Nearby"),r.a.createElement(i.b,{to:"/home/login"},"Login"),r.a.createElement(i.b,{to:"/home/logout"},"Logout"))},k={local:{serverPath:"http://192.168.50.253"},prod:{serverPath:"https://artemcams.serveo.net"}};var E=function(e){return k.prod[e]},x="undefined"!==typeof localStorage,y=new(function(){function e(){Object(m.a)(this,e),this.memoryStore={},this.lastExpirationCheck=0}return Object(p.a)(e,[{key:"_checkForExpired",value:function(){if(!(Date.now()<this.lastExpirationCheck+36e5)){this.lastExpirationCheck=Date.now();var e=this._getStore();Object.keys(e).forEach(function(t){e[t].expiration<Date.now()&&delete e[t]}),this._setStore(e)}}},{key:"_getStore",value:function(){if(x){var e=localStorage.getItem("ARTEM_DATA_STORE");if(e)return JSON.parse(e)}return this.memoryStore}},{key:"_setStore",value:function(e){this._checkForExpired(),this.memoryStore=e,x&&localStorage.setItem("ARTEM_DATA_STORE",JSON.stringify(e))}},{key:"set",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12096e5,a=this._getStore();return a[e]={expiration:Date.now()+n,value:t},this._setStore(a),t}},{key:"get",value:function(e){var t=this._getStore()[e];if(t)return t.expiration<Date.now()?this.clear(e):t.value}},{key:"clear",value:function(e){var t=this._getStore();delete t[e],this._setStore(t)}}]),e}()),O=new(function(){function e(){Object(m.a)(this,e),this.auth=null}return Object(p.a)(e,[{key:"setAuth",value:function(e){this.auth=e||null,y.set("auth",e)}},{key:"clearAuth",value:function(){this.auth=null,y.clear("auth")}},{key:"getToken",value:function(){return null===this.auth&&this.setAuth(y.get("auth")),null===this.auth?null:this.auth.token}}]),e}()),j=new(function(){function e(){Object(m.a)(this,e)}return Object(p.a)(e,[{key:"getTotalCameras",value:function(){var e=Object(h.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",3);case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getCameraImage",value:function(){var e=Object(h.a)(l.a.mark(function e(t){var n,a,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(n=O.getToken())){e.next=3;break}throw new Error("UNAUTHORIZED");case 3:return e.next=5,fetch("".concat(E("serverPath"),"/api/img/").concat(t),{method:"GET",headers:{Authorization:n}});case 5:return a=e.sent,e.next=8,a.blob();case 8:return r=e.sent,e.abrupt("return",r);case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),e}()),_=n(29),S=n.n(_),T=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(f.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={images:[],totalCameras:0},n.mounted=!1,n.fetchImages=Object(h.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.mounted){e.next=2;break}return e.abrupt("return");case 2:t=l.a.mark(function e(t){var a,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.getCameraImage(t);case 3:if(a=e.sent,r=URL.createObjectURL(a),n.mounted){e.next=7;break}return e.abrupt("return","break");case 7:n.setState(function(e){var n=e.images.slice();return n.splice(t,1,r),{images:n}}),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(0);case 12:case"end":return e.stop()}},e,null,[[0,10]])}),a=0;case 4:if(!(a<n.state.totalCameras)){e.next=12;break}return e.delegateYield(t(a),"t0",6);case 6:if("break"!==e.t0){e.next=9;break}return e.abrupt("break",12);case 9:a++,e.next=4;break;case 12:setTimeout(n.fetchImages,1e3);case 13:case"end":return e.stop()}},e)})),n}return Object(d.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=Object(h.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.mounted=!0,e.next=3,j.getTotalCameras();case 3:if(t=e.sent,this.mounted){e.next=6;break}return e.abrupt("return");case 6:this.setState({totalCameras:t}),this.fetchImages();case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){return null===O.getToken()?r.a.createElement(u.a,{to:"/home/login"}):r.a.createElement(r.a.Fragment,null,r.a.createElement(w,null),this.state.images.map(function(e,t){return r.a.createElement("img",{className:S.a.image,key:t,alt:"cam",src:e})}))}}]),t}(r.a.Component),A=n(11),C=n(19),N=n.n(C),D=new(function(){function e(){Object(m.a)(this,e)}return Object(p.a)(e,[{key:"openGate",value:function(){var e=Object(h.a)(l.a.mark(function e(){var t,n,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=O.getToken())){e.next=3;break}throw new Error("UNAUTHORIZED");case 3:return e.next=5,fetch("".concat(E("serverPath"),"/api/keypad/open"),{method:"POST",headers:{Authorization:t}});case 5:return n=e.sent,e.next=8,n.text();case 8:return a=e.sent,e.abrupt("return",a);case 10:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getLogs",value:function(){var e=Object(h.a)(l.a.mark(function e(){var t,n,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=O.getToken())){e.next=3;break}throw new Error("UNAUTHORIZED");case 3:return e.next=5,fetch("".concat(E("serverPath"),"/api/keypad/logs"),{method:"GET",headers:{Authorization:t}});case 5:return n=e.sent,e.next=8,n.text();case 8:return a=e.sent,e.abrupt("return",a);case 10:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}()),U=function(){var e=Object(a.useState)(""),t=Object(A.a)(e,2),n=t[0],o=t[1];n||D.getLogs().then(o);var c=Object(a.useState)(""),i=Object(A.a)(c,2),u=i[0],s=i[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(w,null),r.a.createElement("div",{className:N.a.container},r.a.createElement("input",{type:"submit",value:"Open Gate",onClick:function(){return D.openGate().then(s)}}),r.a.createElement("div",null,u),r.a.createElement("div",{className:N.a.logs},n.split("\n").reverse().join("\n"))))},R=n(20),I=n.n(R),P=new(function(){function e(){Object(m.a)(this,e)}return Object(p.a)(e,[{key:"comingHome",value:function(){var e=Object(h.a)(l.a.mark(function e(){var t,n,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=O.getToken())){e.next=3;break}throw new Error("UNAUTHORIZED");case 3:return e.next=5,fetch("".concat(E("serverPath"),"/api/announce/coming_home"),{method:"POST",headers:{Authorization:t}});case 5:return n=e.sent,e.next=8,n.text();case 8:return a=e.sent,e.abrupt("return",a);case 10:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}()),H=function(){var e=Object(a.useState)(""),t=Object(A.a)(e,2),n=t[0],o=t[1];function c(){return(c=Object(h.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.comingHome();case 2:t=e.sent,o(t);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}return r.a.createElement(r.a.Fragment,null,r.a.createElement(w,null),r.a.createElement("div",{className:I.a.container},r.a.createElement("input",{type:"submit",value:"Coming Home",onClick:function(){return c.apply(this,arguments)}}),r.a.createElement("div",{className:I.a.response},n)))},L=new(function(){function e(){Object(m.a)(this,e)}return Object(p.a)(e,[{key:"currentDevices",value:function(){var e=Object(h.a)(l.a.mark(function e(){var t,n,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=O.getToken())){e.next=3;break}throw new Error("UNAUTHORIZED");case 3:return e.next=5,fetch("".concat(E("serverPath"),"/api/nearby_devices/current"),{headers:{Authorization:t}});case 5:return n=e.sent,e.next=8,n.text();case 8:return a=e.sent,e.abrupt("return",a);case 10:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"allDevices",value:function(){var e=Object(h.a)(l.a.mark(function e(){var t,n,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=O.getToken())){e.next=3;break}throw new Error("UNAUTHORIZED");case 3:return e.next=5,fetch("".concat(E("serverPath"),"/api/nearby_devices/all"),{headers:{Authorization:t}});case 5:return n=e.sent,e.next=8,n.text();case 8:return a=e.sent,e.abrupt("return",a);case 10:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}()),W=function(){var e=Object(a.useState)(""),t=Object(A.a)(e,2),n=t[0],o=t[1];return n||L.currentDevices().then(function(e){o(e)}),r.a.createElement(r.a.Fragment,null,r.a.createElement(w,null),r.a.createElement("h1",null,"Nearby Devices"),r.a.createElement("div",{id:"current",dangerouslySetInnerHTML:{__html:n}}),r.a.createElement("h1",null,"All Devices"),r.a.createElement("div",{id:"all"}))},z=n(16),F=n.n(z),Z=new(function(){function e(){Object(m.a)(this,e)}return Object(p.a)(e,[{key:"login",value:function(){var e=Object(h.a)(l.a.mark(function e(t,n){var a,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(E("serverPath"),"/api/login"),{method:"POST",body:JSON.stringify({username:t,password:n,redirect:!1}),headers:{"Content-Type":"application/json"}});case 2:return a=e.sent,e.next=5,a.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}()),G=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(f.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={loggedIn:!1,username:"",password:""},n.login=function(){var e=Object(h.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,Z.login(n.state.username,n.state.password);case 3:a=e.sent,O.setAuth(a),n.setState({});case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n}return Object(d.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this;return null!==O.getToken()?r.a.createElement(u.a,{to:"/"}):r.a.createElement("div",{className:F.a.container},r.a.createElement("form",{onSubmit:this.login},r.a.createElement("div",{className:F.a.header},"Login"),r.a.createElement("input",{placeholder:"Username",type:"text",name:"username",onChange:function(t){return e.setState({username:t.target.value})}}),r.a.createElement("input",{placeholder:"Password",type:"password",name:"password",onChange:function(t){return e.setState({password:t.target.value})}}),r.a.createElement("input",{className:F.a.submit,type:"submit",name:"submit"})))}}]),t}(r.a.Component),J=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(w,null),r.a.createElement("div",null,"Home"))},M=function(){return O.clearAuth(),r.a.createElement(u.a,{to:"/login"})},Q=function(){return r.a.createElement(i.a,null,r.a.createElement(u.b,{path:"/home/",exact:!0,component:J}),r.a.createElement(u.b,{path:"/home/login",exact:!0,component:G}),r.a.createElement(u.b,{path:"/home/logout",exact:!0,component:M}),r.a.createElement(u.b,{path:"/home/cams",exact:!0,component:T}),r.a.createElement(u.b,{path:"/home/gate",exact:!0,component:U}),r.a.createElement(u.b,{path:"/home/doorman",exact:!0,component:H}),r.a.createElement(u.b,{path:"/home/nearby",exact:!0,component:W}))},B=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function q(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}c.a.render(r.a.createElement(Q,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/home",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/home","/service-worker.js");B?(function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):q(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):q(t,e)})}}()}},[[30,1,2]]]);
//# sourceMappingURL=main.9b965e6e.chunk.js.map